<!doctype html>
<html lang="en" dir="ltr" class="docs-wrapper plugin-docs plugin-id-default docs-version-current docs-doc-page docs-doc-id-understanding-act" data-has-hydrated="false">
<head>
<meta charset="UTF-8">
<meta name="generator" content="Docusaurus v3.3.2">
<title data-rh="true">Understanding Act function | React Native Testing Library</title><meta data-rh="true" name="viewport" content="width=device-width,initial-scale=1"><meta data-rh="true" name="twitter:card" content="summary_large_image"><meta data-rh="true" property="og:image" content="https://callstack.github.io/react-native-testing-library/img/owl.png"><meta data-rh="true" name="twitter:image" content="https://callstack.github.io/react-native-testing-library/img/owl.png"><meta data-rh="true" property="og:url" content="https://callstack.github.io/react-native-testing-library/docs/understanding-act"><meta data-rh="true" property="og:locale" content="en"><meta data-rh="true" name="docusaurus_locale" content="en"><meta data-rh="true" name="docsearch:language" content="en"><meta data-rh="true" name="docusaurus_version" content="current"><meta data-rh="true" name="docusaurus_tag" content="docs-default-current"><meta data-rh="true" name="docsearch:version" content="current"><meta data-rh="true" name="docsearch:docusaurus_tag" content="docs-default-current"><meta data-rh="true" property="og:title" content="Understanding Act function | React Native Testing Library"><meta data-rh="true" name="description" content="When writing RNTL tests one of the things that confuses developers the most are cryptic act() function errors logged into console. In this article I will try to build an understanding of the purpose and behaviour of act() so you can build your tests with more confidence."><meta data-rh="true" property="og:description" content="When writing RNTL tests one of the things that confuses developers the most are cryptic act() function errors logged into console. In this article I will try to build an understanding of the purpose and behaviour of act() so you can build your tests with more confidence."><link data-rh="true" rel="icon" href="/react-native-testing-library/img/owl.png"><link data-rh="true" rel="canonical" href="https://callstack.github.io/react-native-testing-library/docs/understanding-act"><link data-rh="true" rel="alternate" href="https://callstack.github.io/react-native-testing-library/docs/understanding-act" hreflang="en"><link data-rh="true" rel="alternate" href="https://callstack.github.io/react-native-testing-library/docs/understanding-act" hreflang="x-default"><link data-rh="true" rel="preconnect" href="https://6CJ0BV6AVN-dsn.algolia.net" crossorigin="anonymous"><link rel="search" type="application/opensearchdescription+xml" title="React Native Testing Library" href="/react-native-testing-library/opensearch.xml"><link rel="stylesheet" href="/react-native-testing-library/assets/css/styles.b7c34a9c.css">
<script src="/react-native-testing-library/assets/js/runtime~main.30f66bcb.js" defer="defer"></script>
<script src="/react-native-testing-library/assets/js/main.f13172a2.js" defer="defer"></script>
</head>
<body class="navigation-with-keyboard">
<script>!function(){function t(t){document.documentElement.setAttribute("data-theme",t)}var e=function(){try{return new URLSearchParams(window.location.search).get("docusaurus-theme")}catch(t){}}()||function(){try{return localStorage.getItem("theme")}catch(t){}}();t(null!==e?e:"light")}(),function(){try{const c=new URLSearchParams(window.location.search).entries();for(var[t,e]of c)if(t.startsWith("docusaurus-data-")){var a=t.replace("docusaurus-data-","data-");document.documentElement.setAttribute(a,e)}}catch(t){}}()</script><div id="__docusaurus"><div role="region" aria-label="Skip to main content"><a class="skipToContent_fXgn" href="#__docusaurus_skipToContent_fallback">Skip to main content</a></div><nav aria-label="Main" class="navbar navbar--fixed-top"><div class="navbar__inner"><div class="navbar__items"><button aria-label="Toggle navigation bar" aria-expanded="false" class="navbar__toggle clean-btn" type="button"><svg width="30" height="30" viewBox="0 0 30 30" aria-hidden="true"><path stroke="currentColor" stroke-linecap="round" stroke-miterlimit="10" stroke-width="2" d="M4 7h22M4 15h22M4 23h22"></path></svg></button><a class="navbar__brand" href="/react-native-testing-library/"><div class="navbar__logo"><img src="/react-native-testing-library/img/owl.png" alt="React Native Testing Library" class="themedComponent_mlkZ themedComponent--light_NVdE"><img src="/react-native-testing-library/img/owl.png" alt="React Native Testing Library" class="themedComponent_mlkZ themedComponent--dark_xIcU"></div><b class="navbar__title text--truncate">React Native Testing Library</b></a></div><div class="navbar__items navbar__items--right"><a class="navbar__item navbar__link" href="/react-native-testing-library/docs/getting-started">Docs</a><a href="https://github.com/callstack/react-native-testing-library" target="_blank" rel="noopener noreferrer" class="navbar__item navbar__link">GitHub<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_nPIU"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a><div class="toggle_vylO colorModeToggle_DEke"><button class="clean-btn toggleButton_gllP toggleButtonDisabled_aARS" type="button" disabled="" title="Switch between dark and light mode (currently light mode)" aria-label="Switch between dark and light mode (currently light mode)" aria-live="polite"><svg viewBox="0 0 24 24" width="24" height="24" class="lightToggleIcon_pyhR"><path fill="currentColor" d="M12,9c1.65,0,3,1.35,3,3s-1.35,3-3,3s-3-1.35-3-3S10.35,9,12,9 M12,7c-2.76,0-5,2.24-5,5s2.24,5,5,5s5-2.24,5-5 S14.76,7,12,7L12,7z M2,13l2,0c0.55,0,1-0.45,1-1s-0.45-1-1-1l-2,0c-0.55,0-1,0.45-1,1S1.45,13,2,13z M20,13l2,0c0.55,0,1-0.45,1-1 s-0.45-1-1-1l-2,0c-0.55,0-1,0.45-1,1S19.45,13,20,13z M11,2v2c0,0.55,0.45,1,1,1s1-0.45,1-1V2c0-0.55-0.45-1-1-1S11,1.45,11,2z M11,20v2c0,0.55,0.45,1,1,1s1-0.45,1-1v-2c0-0.55-0.45-1-1-1C11.45,19,11,19.45,11,20z M5.99,4.58c-0.39-0.39-1.03-0.39-1.41,0 c-0.39,0.39-0.39,1.03,0,1.41l1.06,1.06c0.39,0.39,1.03,0.39,1.41,0s0.39-1.03,0-1.41L5.99,4.58z M18.36,16.95 c-0.39-0.39-1.03-0.39-1.41,0c-0.39,0.39-0.39,1.03,0,1.41l1.06,1.06c0.39,0.39,1.03,0.39,1.41,0c0.39-0.39,0.39-1.03,0-1.41 L18.36,16.95z M19.42,5.99c0.39-0.39,0.39-1.03,0-1.41c-0.39-0.39-1.03-0.39-1.41,0l-1.06,1.06c-0.39,0.39-0.39,1.03,0,1.41 s1.03,0.39,1.41,0L19.42,5.99z M7.05,18.36c0.39-0.39,0.39-1.03,0-1.41c-0.39-0.39-1.03-0.39-1.41,0l-1.06,1.06 c-0.39,0.39-0.39,1.03,0,1.41s1.03,0.39,1.41,0L7.05,18.36z"></path></svg><svg viewBox="0 0 24 24" width="24" height="24" class="darkToggleIcon_wfgR"><path fill="currentColor" d="M9.37,5.51C9.19,6.15,9.1,6.82,9.1,7.5c0,4.08,3.32,7.4,7.4,7.4c0.68,0,1.35-0.09,1.99-0.27C17.45,17.19,14.93,19,12,19 c-3.86,0-7-3.14-7-7C5,9.07,6.81,6.55,9.37,5.51z M12,3c-4.97,0-9,4.03-9,9s4.03,9,9,9s9-4.03,9-9c0-0.46-0.04-0.92-0.1-1.36 c-0.98,1.37-2.58,2.26-4.4,2.26c-2.98,0-5.4-2.42-5.4-5.4c0-1.81,0.89-3.42,2.26-4.4C12.92,3.04,12.46,3,12,3L12,3z"></path></svg></button></div><div class="navbarSearchContainer_Bca1"><button type="button" class="DocSearch DocSearch-Button" aria-label="Search"><span class="DocSearch-Button-Container"><svg width="20" height="20" class="DocSearch-Search-Icon" viewBox="0 0 20 20"><path d="M14.386 14.386l4.0877 4.0877-4.0877-4.0877c-2.9418 2.9419-7.7115 2.9419-10.6533 0-2.9419-2.9418-2.9419-7.7115 0-10.6533 2.9418-2.9419 7.7115-2.9419 10.6533 0 2.9419 2.9418 2.9419 7.7115 0 10.6533z" stroke="currentColor" fill="none" fill-rule="evenodd" stroke-linecap="round" stroke-linejoin="round"></path></svg><span class="DocSearch-Button-Placeholder">Search</span></span><span class="DocSearch-Button-Keys"></span></button></div></div></div><div role="presentation" class="navbar-sidebar__backdrop"></div></nav><div id="__docusaurus_skipToContent_fallback" class="main-wrapper mainWrapper_z2l0"><div class="docsWrapper_hBAB"><button aria-label="Scroll back to top" class="clean-btn theme-back-to-top-button backToTopButton_sjWU" type="button"></button><div class="docRoot_UBD9"><aside class="theme-doc-sidebar-container docSidebarContainer_YfHR"><div class="sidebarViewport_aRkj"><div class="sidebar_njMd"><nav aria-label="Docs sidebar" class="menu thin-scrollbar menu_SIkG"><ul class="theme-doc-sidebar-menu menu__list"><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item"><div class="menu__list-item-collapsible"><a class="menu__link">Introduction</a></div><ul style="display:block;overflow:visible;height:auto" class="menu__list"><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/react-native-testing-library/docs/getting-started">Getting Started</a></li></ul></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item"><div class="menu__list-item-collapsible"><a class="menu__link">API Reference</a></div><ul style="display:block;overflow:visible;height:auto" class="menu__list"><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/react-native-testing-library/docs/api">Overview</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/react-native-testing-library/docs/render">Render function</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/react-native-testing-library/docs/screen">Screen object</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/react-native-testing-library/docs/queries">Queries</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/react-native-testing-library/docs/jest-matchers">Jest Matchers</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/react-native-testing-library/docs/user-event">User Event</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/react-native-testing-library/docs/fire-event">Fire Event</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/react-native-testing-library/docs/render-hook">Render Hook API</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/react-native-testing-library/docs/other">Other APIs</a></li></ul></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item"><div class="menu__list-item-collapsible"><a class="menu__link">Guides</a></div><ul style="display:block;overflow:visible;height:auto" class="menu__list"><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/react-native-testing-library/docs/how-should-i-query">How Should I Query?</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/react-native-testing-library/docs/troubleshooting">Troubleshooting</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/react-native-testing-library/docs/faq">FAQ</a></li></ul></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--active">Advanced</a></div><ul style="display:block;overflow:visible;height:auto" class="menu__list"><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/react-native-testing-library/docs/testing-env">Testing Environment</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link menu__link--active" aria-current="page" tabindex="0" href="/react-native-testing-library/docs/understanding-act">Understanding Act function</a></li></ul></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item"><div class="menu__list-item-collapsible"><a class="menu__link">Community</a></div><ul style="display:block;overflow:visible;height:auto" class="menu__list"><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/react-native-testing-library/docs/community-resources">Community Resources</a></li></ul></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item"><div class="menu__list-item-collapsible"><a class="menu__link">Migrations</a></div><ul style="display:block;overflow:visible;height:auto" class="menu__list"><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/react-native-testing-library/docs/migration-jest-native">Migration from Jest Native matchers</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/react-native-testing-library/docs/migration-v12">Migration to 12.0</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/react-native-testing-library/docs/migration-v11">Migration to 11.0</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/react-native-testing-library/docs/migration-v9">Migration to 9.0</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/react-native-testing-library/docs/migration-v7">Migration to 7.0</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/react-native-testing-library/docs/migration-v2">Migration to 2.0</a></li></ul></li></ul></nav></div></div></aside><main class="docMainContainer_TBSr"><div class="container padding-top--md padding-bottom--lg"><div class="row"><div class="col docItemCol_VOVn"><div class="docItemContainer_Djhp"><article><nav class="theme-doc-breadcrumbs breadcrumbsContainer_Z_bl" aria-label="Breadcrumbs"><ul class="breadcrumbs" itemscope="" itemtype="https://schema.org/BreadcrumbList"><li class="breadcrumbs__item"><a aria-label="Home page" class="breadcrumbs__link" href="/react-native-testing-library/"><svg viewBox="0 0 24 24" class="breadcrumbHomeIcon_YNFT"><path d="M10 19v-5h4v5c0 .55.45 1 1 1h3c.55 0 1-.45 1-1v-7h1.7c.46 0 .68-.57.33-.87L12.67 3.6c-.38-.34-.96-.34-1.34 0l-8.36 7.53c-.34.3-.13.87.33.87H5v7c0 .55.45 1 1 1h3c.55 0 1-.45 1-1z" fill="currentColor"></path></svg></a></li><li class="breadcrumbs__item"><span class="breadcrumbs__link">Advanced</span><meta itemprop="position" content="1"></li><li itemscope="" itemprop="itemListElement" itemtype="https://schema.org/ListItem" class="breadcrumbs__item breadcrumbs__item--active"><span class="breadcrumbs__link" itemprop="name">Understanding Act function</span><meta itemprop="position" content="2"></li></ul></nav><div class="tocCollapsible_ETCw theme-doc-toc-mobile tocMobile_ITEo"><button type="button" class="clean-btn tocCollapsibleButton_TO0P">On this page</button></div><div class="theme-doc-markdown markdown"><header><h1>Understanding Act function</h1></header><p>When writing RNTL tests one of the things that confuses developers the most are cryptic <a href="https://reactjs.org/docs/testing-recipes.html#act"><code>act()</code></a> function errors logged into console. In this article I will try to build an understanding of the purpose and behaviour of <code>act()</code> so you can build your tests with more confidence.</p>
<div class="tableOfContentsInline_prmo"><ul class="table-of-contents"><li><a href="#act-warnings"><code>act</code> warnings</a></li><li><a href="#synchronous-act">Synchronous <code>act</code></a><ul><li><a href="#responsibility">Responsibility</a></li><li><a href="#when-to-use-act">When to use act</a></li><li><a href="#implementation">Implementation</a></li></ul></li><li><a href="#asynchronous-act">Asynchronous <code>act</code></a><ul><li><a href="#asynchronous-code">Asynchronous code</a></li><li><a href="#solution-with-fake-timers">Solution with fake timers</a></li><li><a href="#solution-with-real-timers">Solution with real timers</a></li><li><a href="#async-act-warning">Async act warning</a></li></ul></li><li><a href="#references">References</a></li></ul></div>
<h2 id="act-warnings"><code>act</code> warnings</h2>
<p>Let’s start with typical <code>act()</code> warnings logged to console. There are two kinds of these issues, let’s call the first one the &quot;sync <code>act()</code>&quot; warning:</p>
<pre><code>Warning: An update to Component inside a test was not wrapped in act(...).

When testing, code that causes React state updates should be wrapped into act(...):

act(() =&gt; {
  /* fire events that update state */
});
/* assert on the output */
</code></pre>
<p>The second one relates to async usage of <code>act</code> so let’s call it the &quot;async <code>act</code>&quot; error:</p>
<pre><code>Warning: You called act(async () =&gt; ...) without await. This could lead to unexpected
testing behaviour, interleaving multiple act calls and mixing their scopes. You should
- await act(async () =&gt; ...);
</code></pre>
<h2 id="synchronous-act">Synchronous <code>act</code></h2>
<h3 id="responsibility">Responsibility</h3>
<p>This function is intended only for using in automated tests and works only in development mode. Attempting to use it in production build will throw an error.</p>
<p>The responsibility for <code>act</code> function is to make React renders and updates work in tests in a similar way they work in real application by grouping and executing related units of interaction (e.g. renders, effects, etc) together.</p>
<p>To showcase that behaviour let make a small experiment. First we define a function component that uses <code>useEffect</code> hook in a trivial way.</p>
<pre><code class="language-jsx">function TestComponent() {
  const [count, setCount] = React.useState(0);
  React.useEffect(() =&gt; {
    setCount((c) =&gt; c + 1);
  }, []);

  return &lt;Text&gt;Count {count}&lt;/Text&gt;;
}
</code></pre>
<p>In the following tests we will directly use <code>ReactTestRenderer</code> instead of RNTL <code>render</code> function to render our component for tests. In order to expose familiar queries like <code>getByText</code> we will use <code>within</code> function from RNTL.</p>
<pre><code class="language-jsx">test(&#x27;render without act&#x27;, () =&gt; {
  const renderer = TestRenderer.create(&lt;TestComponent /&gt;);

  // Bind RNTL queries for root element.
  const view = within(renderer.root);
  expect(view.getByText(&#x27;Count 0&#x27;)).toBeOnTheScreen();
});
</code></pre>
<p>When testing without <code>act</code> call wrapping rendering call, we see that the assertion runs just after the rendering but before <code>useEffect</code>hooks effects are applied. Which is not what we expected in our tests.</p>
<pre><code class="language-jsx">test(&#x27;render with act&#x27;, () =&gt; {
  let renderer: ReactTestRenderer;
  act(() =&gt; {
    renderer = TestRenderer.create(&lt;TestComponent /&gt;);
  });

  // Bind RNTL queries for root element.
  const view = within(renderer!.root);
  expect(view.getByText(&#x27;Count 1&#x27;)).toBeOnTheScreen();
});
</code></pre>
<p>When wrapping rendering call with <code>act</code> we see that the changes caused by <code>useEffect</code> hook have been applied as we would expect.</p>
<h3 id="when-to-use-act">When to use act</h3>
<p>The name <code>act</code> comes from <a href="http://wiki.c2.com/?ArrangeActAssert">Arrange-Act-Assert</a> unit testing pattern. Which means it’s related to part of the test when we execute some actions on the component tree.</p>
<p>So far we learned that <code>act</code> function allows tests to wait for all pending React interactions to be applied before we make our assertions. When using <code>act</code> we get guarantee that any state updates will be executed as well as any enqueued effects will be executed.</p>
<p>Therefore, we should use <code>act</code> whenever there is some action that causes element tree to render, particularly:</p>
<ul>
<li>initial render call - <code>ReactTestRenderer.create</code> call</li>
<li>re-rendering of component -<code>renderer.update</code> call</li>
<li>triggering any event handlers that cause component tree render</li>
</ul>
<p>Thankfully, for these basic cases RNTL has got you covered as our <code>render</code>, <code>update</code> and <code>fireEvent</code> methods already wrap their calls in sync <code>act</code> so that you do not have to do it explicitly.</p>
<p>Note that <code>act</code> calls can be safely nested and internally form a stack of calls. However, overlapping <code>act</code> calls, which can be achieved using async version of <code>act</code>, <a href="https://github.com/facebook/react/blob/main/packages/react/src/ReactAct.js#L161">are not supported</a>.</p>
<h3 id="implementation">Implementation</h3>
<p>As of React version of 18.1.0, the <code>act</code> implementation is defined in the <a href="https://github.com/facebook/react/blob/main/packages/react/src/ReactAct.js">ReactAct.js source file</a> inside React repository. This implementation has been fairly stable since React 17.0.</p>
<p>RNTL exports <code>act</code> for convenience of the users as defined in the <a href="https://github.com/callstack/react-native-testing-library/blob/main/src/act.ts">act.ts source file</a>. That file refers to <a href="https://github.com/facebook/react/blob/ce13860281f833de8a3296b7a3dad9caced102e9/packages/react-test-renderer/src/ReactTestRenderer.js#L52">ReactTestRenderer.js source</a> file from React Test Renderer package, which finally leads to React act implementation in ReactAct.js (already mentioned above).</p>
<h2 id="asynchronous-act">Asynchronous <code>act</code></h2>
<p>So far we have seen synchronous version of <code>act</code> which runs its callback immediately. This can deal with things like synchronous effects or mocks using already resolved promises. However, not all component code is synchronous. Frequently our components or mocks contain some asynchronous behaviours like <code>setTimeout</code> calls or network calls. Starting from React 16.9, <code>act</code> can also be called in asynchronous mode. In such case <code>act</code> implementation checks that the passed callback returns <a href="https://github.com/facebook/react/blob/ce13860281f833de8a3296b7a3dad9caced102e9/packages/react/src/ReactAct.js#L60">object resembling promise</a>.</p>
<h3 id="asynchronous-code">Asynchronous code</h3>
<p>Asynchronous version of <code>act</code> also is executed immediately, but the callback is not yet completed because of some asynchronous operations inside.</p>
<p>Lets look at a simple example with component using <code>setTimeout</code> call to simulate asynchronous behaviour:</p>
<pre><code class="language-jsx">function TestAsyncComponent() {
  const [count, setCount] = React.useState(0);
  React.useEffect(() =&gt; {
    setTimeout(() =&gt; {
      setCount((c) =&gt; c + 1);
    }, 50);
  }, []);

  return &lt;Text&gt;Count {count}&lt;/Text&gt;;
}
</code></pre>
<pre><code class="language-jsx">import { render, screen } from &#x27;@testing-library/react-native&#x27;;

test(&#x27;render async natively&#x27;, () =&gt; {
  render(&lt;TestAsyncComponent /&gt;);
  expect(screen.getByText(&#x27;Count 0&#x27;)).toBeOnTheScreen();
});
</code></pre>
<p>If we test our component in a native way without handling its asynchronous behaviour we will end up with sync act warning:</p>
<pre><code>Warning: An update to TestAsyncComponent inside a test was not wrapped in act(...).

When testing, code that causes React state updates should be wrapped into act(...):

act(() =&gt; {
  /* fire events that update state */
});
/* assert on the output */
</code></pre>
<p>Note that this is not yet the infamous async act warning. It only asks us to wrap our event code with <code>act</code> calls. However, this time our immediate state change does not originate from externally triggered events but rather forms an internal part of the component. So how can we apply <code>act</code> in such scenario?</p>
<h3 id="solution-with-fake-timers">Solution with fake timers</h3>
<p>First solution is to use Jest&#x27;s fake timers inside out tests:</p>
<pre><code class="language-jsx">test(&#x27;render with fake timers&#x27;, () =&gt; {
  jest.useFakeTimers();
  render(&lt;TestAsyncComponent /&gt;);

  act(() =&gt; {
    jest.runAllTimers();
  });
  expect(screen.getByText(&#x27;Count 1&#x27;)).toBeOnTheScreen();
});
</code></pre>
<p>That way we can wrap <code>jest.runAllTimers()</code> call which triggers the <code>setTimeout</code> updates inside an <code>act</code> call, hence resolving the act warning. Note that this whole code is synchronous thanks to usage of Jest fake timers.</p>
<h3 id="solution-with-real-timers">Solution with real timers</h3>
<p>If we wanted to stick with real timers then things get a bit more complex. Let’s start by applying a crude solution of opening async <code>act()</code> call for the expected duration of components updates:</p>
<pre><code class="language-jsx">test(&#x27;render with real timers - sleep&#x27;, async () =&gt; {
  render(&lt;TestAsyncComponent /&gt;);
  await act(async () =&gt; {
    await sleep(100); // Wait a bit longer than setTimeout in `TestAsyncComponent`
  });

  expect(screen.getByText(&#x27;Count 1&#x27;)).toBeOnTheScreen();
});
</code></pre>
<p>This works correctly as we use an explicit async <code>act()</code> call that resolves the console error. However, it relies on our knowledge of exact implementation details which is a bad practice.</p>
<p>Let’s try more elegant solution using <code>waitFor</code> that will wait for our desired state:</p>
<pre><code class="language-jsx">test(&#x27;render with real timers - waitFor&#x27;, async () =&gt; {
  render(&lt;TestAsyncComponent /&gt;);

  await waitFor(() =&gt; screen.getByText(&#x27;Count 1&#x27;));
  expect(screen.getByText(&#x27;Count 1&#x27;)).toBeOnTheScreen();
});
</code></pre>
<p>This also works correctly, because <code>waitFor</code> call executes async <code>act()</code> call internally.</p>
<p>The above code can be simplified using <code>findBy</code> query:</p>
<pre><code class="language-jsx">test(&#x27;render with real timers - findBy&#x27;, async () =&gt; {
  render(&lt;TestAsyncComponent /&gt;);

  expect(await screen.findByText(&#x27;Count 1&#x27;)).toBeOnTheScreen();
});
</code></pre>
<p>This also works since <code>findByText</code> internally calls <code>waitFor</code> which uses async <code>act()</code>.</p>
<p>Note that all of the above examples are async tests using &amp; awaiting async <code>act()</code> function call.</p>
<h3 id="async-act-warning">Async act warning</h3>
<p>If we modify any of the above async tests and remove <code>await</code> keyword, then we will trigger the notorious async <code>act()</code>warning:</p>
<pre><code class="language-jsx">Warning: You called act(async () =&gt; ...) without await. This could lead to unexpected
testing behaviour, interleaving multiple act calls and mixing their scopes. You should
- await act(async () =&gt; ...);
</code></pre>
<p>React decides to show this error whenever it detects that async <code>act()</code>call <a href="https://github.com/facebook/react/blob/ce13860281f833de8a3296b7a3dad9caced102e9/packages/react/src/ReactAct.js#L93">has not been awaited</a>.</p>
<p>The exact reasons why you might see async <code>act()</code> warnings vary, but finally it means that <code>act()</code> has been called with callback that returns <code>Promise</code>-like object, but it has not been waited on.</p>
<h2 id="references">References</h2>
<ul>
<li><a href="https://github.com/facebook/react/blob/main/packages/react/src/ReactAct.js">React <code>act</code> implementation source</a></li>
<li><a href="https://reactjs.org/docs/testing-recipes.html#act">React testing recipes: <code>act()</code></a></li>
</ul></div><footer class="theme-doc-footer docusaurus-mt-lg"><div class="row margin-top--sm theme-doc-footer-edit-meta-row"><div class="col"><a href="https://github.com/callstack/react-native-testing-library/blob/main/website/docs/UnderstandingAct.md" target="_blank" rel="noopener noreferrer" class="theme-edit-this-page"><svg fill="currentColor" height="20" width="20" viewBox="0 0 40 40" class="iconEdit_Z9Sw" aria-hidden="true"><g><path d="m34.5 11.7l-3 3.1-6.3-6.3 3.1-3q0.5-0.5 1.2-0.5t1.1 0.5l3.9 3.9q0.5 0.4 0.5 1.1t-0.5 1.2z m-29.5 17.1l18.4-18.5 6.3 6.3-18.4 18.4h-6.3v-6.2z"></path></g></svg>Edit this page</a></div><div class="col lastUpdated_JAkA"></div></div></footer></article><nav class="pagination-nav docusaurus-mt-lg" aria-label="Docs pages"><a class="pagination-nav__link pagination-nav__link--prev" href="/react-native-testing-library/docs/testing-env"><div class="pagination-nav__sublabel">Previous</div><div class="pagination-nav__label">Testing Environment</div></a><a class="pagination-nav__link pagination-nav__link--next" href="/react-native-testing-library/docs/community-resources"><div class="pagination-nav__sublabel">Next</div><div class="pagination-nav__label">Community Resources</div></a></nav></div></div><div class="col col--3"><div class="tableOfContents_bqdL thin-scrollbar theme-doc-toc-desktop"><ul class="table-of-contents table-of-contents__left-border"><li><a href="#act-warnings" class="table-of-contents__link toc-highlight"><code>act</code> warnings</a></li><li><a href="#synchronous-act" class="table-of-contents__link toc-highlight">Synchronous <code>act</code></a><ul><li><a href="#responsibility" class="table-of-contents__link toc-highlight">Responsibility</a></li><li><a href="#when-to-use-act" class="table-of-contents__link toc-highlight">When to use act</a></li><li><a href="#implementation" class="table-of-contents__link toc-highlight">Implementation</a></li></ul></li><li><a href="#asynchronous-act" class="table-of-contents__link toc-highlight">Asynchronous <code>act</code></a><ul><li><a href="#asynchronous-code" class="table-of-contents__link toc-highlight">Asynchronous code</a></li><li><a href="#solution-with-fake-timers" class="table-of-contents__link toc-highlight">Solution with fake timers</a></li><li><a href="#solution-with-real-timers" class="table-of-contents__link toc-highlight">Solution with real timers</a></li><li><a href="#async-act-warning" class="table-of-contents__link toc-highlight">Async act warning</a></li></ul></li><li><a href="#references" class="table-of-contents__link toc-highlight">References</a></li></ul></div></div></div></div></main></div></div></div><footer class="footer footer--dark"><div class="container container-fluid"><div class="row footer__links"><div class="col footer__col"><div class="footer__title">Docs</div><ul class="footer__items clean-list"><li class="footer__item"><a class="footer__link-item" href="/react-native-testing-library/docs/getting-started">Getting started</a></li><li class="footer__item"><a class="footer__link-item" href="/react-native-testing-library/docs/api">API</a></li></ul></div><div class="col footer__col"><div class="footer__title">Community</div><ul class="footer__items clean-list"><li class="footer__item"><a href="http://stackoverflow.com/questions/tagged/react-native-testing-library" target="_blank" rel="noopener noreferrer" class="footer__link-item">Stack Overflow<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_nPIU"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a></li><li class="footer__item"><a href="https://discord.gg/QbGezWe" target="_blank" rel="noopener noreferrer" class="footer__link-item">Discord Channel<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_nPIU"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a></li></ul></div><div class="col footer__col"><div class="footer__title">More</div><ul class="footer__items clean-list"><li class="footer__item"><a href="https://github.com/callstack/react-native-testing-library" target="_blank" rel="noopener noreferrer" class="footer__link-item">GitHub<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_nPIU"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a></li><li class="footer__item"><a href="https://github.com/callstack/react-native-testing-library" target="_blank" rel="noopener noreferrer" class="footer__link-item">Star<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_nPIU"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a></li></ul></div></div><div class="footer__bottom text--center"><div class="footer__copyright">Copyright © 2024 Callstack Open Source</div></div></div></footer></div>
</body>
</html>